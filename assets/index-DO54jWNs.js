var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);import{r as i,g as s}from"./phaser-CKN4kaq3.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const o=s(i());class n extends o.Scene{constructor(){super({key:"BootScene"})}preload(){this.load.image("bg","assets/images/background/bg.png"),this.load.atlas("bubbles","assets/images/bubbles/bubbles_spritesheet.png","assets/images/bubbles/bubbles_spritesheet.json"),this.load.atlas("ui","assets/images/ui/ui.png","assets/images/ui/ui.json")}create(){this.scene.start("MainScene")}}const h={label:"pink",color:15626403},r=[{label:"orange",color:16081665},{label:"yellow",color:16109829},{label:"cyan",color:63127},{label:"light-blue",color:10150133},{label:"purple",color:9269719},{label:"pink",color:15626403}];class a extends o.GameObjects.Sprite{constructor(t,i,s,o,n=h,r=!1,a="bubbles"){super(t,i,s,a,n.label),e(this,"isShooter"),e(this,"color"),e(this,"diameter"),e(this,"gridCoordinates"),this.isShooter=r,this.color=n,this.diameter=o,this.setBubbleSize(),this.initPhysics(),this.scene.add.existing(this)}shot(t,e=600){if(!this.isShooter)return;const i=t.x-this.x,s=t.y-this.y,o=Math.sqrt(i*i+s*s);if(o>0){const t=i/o,n=s/o;this.body.setVelocity(t*e,n*e)}}setPosition(t,e){return this.scene.tweens.add({targets:this,x:t,y:e,duration:100,ease:"Power2"}),super.setPosition(t,e)}setBubbleSize(){if(this.width>0){const t=this.diameter/this.width;this.setScale(t)}else this.once(o.Loader.Events.COMPLETE,(()=>{const t=this.diameter/this.width;this.setScale(t)}))}initPhysics(){this.scene.physics.add.existing(this),this.body instanceof o.Physics.Arcade.Body&&(this.body.setCollideWorldBounds(!0),this.body.setVelocity(0,0),this.body.setBounce(1,1))}}const l={even:[[-1,0],[-1,1],[0,-1],[0,1],[1,0],[1,1]],odd:[[-1,-1],[-1,0],[0,-1],[0,1],[1,-1],[1,0]]},c=.85,d=1-c;function b(){const t=Math.floor(Math.random()*r.length);return{label:r[t].label,color:r[t].color}}class g extends o.GameObjects.Group{constructor(t,i,s){super(t),e(this,"rows"),e(this,"cols"),e(this,"cellWidth"),e(this,"cellHeight"),e(this,"bubbleRadius"),e(this,"grid"),this.rows=i,this.cols=s,this.cellWidth=t.scale.width/s,this.bubbleRadius=this.cellWidth/2,this.cellHeight=.866*this.cellWidth;const o=t.scale.height-100-this.cellHeight,n=Math.floor(o/this.cellHeight);this.grid=Array.from({length:n},(()=>Array(s).fill(null)))}createGrid(){for(let t=0;t<this.rows;t++){const e=t%2==0,i=e?this.bubbleRadius:0,s=this.cols-(e?1:0);for(let o=0;o<s;o++){const e=this.normalize(this.bubbleRadius+o*this.cellWidth+i),s=this.normalize(this.bubbleRadius+t*this.cellHeight),n=new a(this.scene,e,s,this.cellWidth,b());n.gridCoordinates={row:t,col:o},this.add(n),this.grid[t][o]=n}}}addBubble(t){const{row:e,col:i}=t.gridCoordinates;this.grid[e][i]=t,this.add(t)}removeBubble(t){const{row:e,col:i}=t.gridCoordinates;this.grid[e]&&this.grid[e][i]===t&&(this.grid[e][i]=null),this.remove(t,!0,!0)}popConnectedBubbles(t){const e=this.findConnectedSameColor(t);e.length>=3&&e.forEach((t=>this.removeBubble(t)))}findConnectedSameColor(t){const e=new Set,i=[];for(i.push(t),e.add(t);i.length>0;){const s=i.shift();e.add(s);const o=this.getNeighbors(s);for(const n of o)e.has(n)||n.color.label!==t.color.label||i.push(n)}return Array.from(e)}getNeighbors(t){const{row:e,col:i}=t.gridCoordinates,s=l[e%2==0?"even":"odd"],o=[];for(const[n,h]of s){const t=e+n,s=i+h;if(this.isValidCell(t,s)){const e=this.grid[t][s];e&&o.push(e)}}return o}snapBubbleToGrid(t){const{snappedX:e,snappedY:i,row:s,col:o}=this.getNearestGridPosition(t.x,t.y);t.setPosition(e,i),t.gridCoordinates={row:s,col:o},this.addBubble(t)}getNearestGridPosition(t,e){let i=Math.round((e-this.bubbleRadius)/this.cellHeight);i<0&&(i=0);const s=i%2==0;let o;o=s?Math.round(t/this.cellWidth-1):Math.round(t/this.cellWidth-.5),o<0&&(o=0);const n=s?this.cellWidth*(o+1):this.cellWidth*(o+.5),h=this.bubbleRadius+i*this.cellHeight;return{snappedX:this.normalize(n),snappedY:this.normalize(h),row:i,col:o}}getChildren(){return super.getChildren()}isValidCell(t,e){return t>=0&&t<this.rows&&e>=0&&e<this.cols}getCellWidth(){return this.cellWidth}normalize(t,e=2){return parseFloat(t.toFixed(e))}}class p extends o.GameObjects.Graphics{constructor(t,i){super(t),e(this,"origin"),e(this,"bubble"),e(this,"dashLength",10),e(this,"gapLength",5),e(this,"aimColor"),e(this,"target"),this.bubble=i,this.origin=new o.Math.Vector2(i.x,i.y),this.target=new o.Math.Vector2(0,0),this.aimColor=i.color.color,t.add.existing(this),this.registerInputListeners()}registerInputListeners(){const t=this.scene.input;t.on("pointerdown",this.onPointerDown,this),t.on("pointermove",this.onPointerMove,this),t.on("pointerup",this.onPointerUp,this)}onPointerDown(t){this.updateTarget(t),this.redrawAimingLine(t)}onPointerMove(t){t.isDown&&(this.updateTarget(t),this.redrawAimingLine(t))}onPointerUp(){this.clear(),this.target.equals(this.origin)||this.bubble.shot({x:this.target.x,y:this.target.y})}updateTarget(t){this.target.set(t.x,t.y)}redrawAimingLine(t){this.clear(),this.lineStyle(1,this.aimColor);const e=o.Math.Angle.Between(this.origin.x,this.origin.y,t.x,t.y),i=Math.sqrt(Math.pow(this.scene.scale.width,2)+Math.pow(this.scene.scale.height,2)),s=new o.Math.Vector2(t.x+Math.cos(e)*i,t.y+Math.sin(e)*i);this.drawDashedLine(this.origin,new o.Math.Vector2(t.x,t.y)),this.drawDashedLine(new o.Math.Vector2(t.x,t.y),s)}drawDashedLine(t,e){const i=o.Math.Distance.Between(t.x,t.y,e.x,e.y),s=o.Math.Angle.Between(t.x,t.y,e.x,e.y);let n=i,h=t.clone();for(;n>0;){const t=Math.min(this.dashLength,n),e=new o.Math.Vector2(h.x+Math.cos(s)*t,h.y+Math.sin(s)*t);this.moveTo(h.x,h.y),this.lineTo(e.x,e.y),h.set(e.x+Math.cos(s)*this.gapLength,e.y+Math.sin(s)*this.gapLength),n-=this.dashLength+this.gapLength}this.strokePath()}destroy(...t){const e=this.scene.input;e.off("pointerdown",this.onPointerDown,this),e.off("pointermove",this.onPointerMove,this),e.off("pointerup",this.onPointerUp,this),super.destroy(...t)}}class u{constructor(t,i,s){e(this,"scene"),e(this,"bubbleGrid"),e(this,"aimer"),e(this,"shootingBubble"),this.scene=t,this.bubbleGrid=new g(t,i,s),this.scene.add.existing(this.bubbleGrid)}createGrid(){this.bubbleGrid.createGrid()}spawnNewShootingBubble(){var t;null==(t=this.aimer)||t.destroy(),this.shootingBubble=new a(this.scene,this.scene.scale.width/2,this.scene.scale.height-100,this.bubbleGrid.getCellWidth(),b(),!0),this.aimer=new p(this.scene,this.shootingBubble)}checkCollision(){this.bubbleGrid.getChildren().forEach((t=>{this.isOverlap(this.shootingBubble,t)&&(this.shootingBubble.body.setVelocity(0,0),this.bubbleGrid.snapBubbleToGrid(this.shootingBubble),this.bubbleGrid.popConnectedBubbles(this.shootingBubble),this.spawnNewShootingBubble())}))}isOverlap(t,e){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s<=t.diameter*e.diameter}}class m extends Phaser.Scene{constructor(){super({key:"GameScene"}),e(this,"bubbleManager")}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg"),this.bubbleManager=new u(this,10,14),this.bubbleManager.createGrid(),this.bubbleManager.spawnNewShootingBubble()}update(){this.bubbleManager.checkCollision()}}const y={green:6810368,yellow:16767754,pink:16550655,purple:12748543,blue:5036798};class w extends Phaser.GameObjects.Container{constructor(t,i,s,o,n,h,r=52,a=48,l=12){super(t,i,s),e(this,"bottomGraphics"),e(this,"topContainer"),e(this,"topGraphics"),e(this,"icon"),e(this,"labelText"),e(this,"originalTopY"),e(this,"pressedTopY");const b=y[o],g=function(t,e=.25){let i=t>>16&255,s=t>>8&255,o=255&t;return i=Math.floor(i*(1-e)),s=Math.floor(s*(1-e)),o=Math.floor(o*(1-e)),(i<<16)+(s<<8)+o}(b);if(this.bottomGraphics=t.add.graphics(),this.bottomGraphics.fillStyle(g),this.bottomGraphics.fillRoundedRect(-r/2,0,r,a,l),this.add(this.bottomGraphics),this.topContainer=t.add.container(0,0),this.add(this.topContainer),this.topGraphics=t.add.graphics(),this.topGraphics.fillStyle(b),this.topGraphics.fillRoundedRect(-r/2,0,r,a*c,l),this.topContainer.add(this.topGraphics),n){this.icon=t.add.image(0,0,n).setOrigin(.5,0);const e=this.icon.height/22;this.icon.setScale(e),this.topContainer.add(this.icon)}if(h){this.labelText=t.add.text(0,0,h,{fontFamily:"LuckiestGuy",fontSize:"18px",color:"#FFFFFF"}).setOrigin(.5,0),this.topContainer.add(this.labelText);const{iconHeight:e,textSpacing:i}=this.icon?{iconHeight:this.icon.displayHeight,textSpacing:4}:{iconHeight:0,textSpacing:8};this.labelText.y=e+i}this.originalTopY=this.topContainer.y,this.pressedTopY=this.originalTopY+a*d,this.setSize(r,a),this.setInteractive(new Phaser.Geom.Rectangle(0,0,r,a),Phaser.Geom.Rectangle.Contains),this.on("pointerdown",this.onPointerDown,this),this.on("pointerup",this.onPointerUp,this),this.on("pointerout",this.onPointerOut,this),t.add.existing(this)}onPointerDown(){this.topContainer.y=this.pressedTopY,this.bottomGraphics.y=this.pressedTopY,this.bottomGraphics.scaleY=c}onPointerUp(){this.topContainer.y=this.originalTopY,this.bottomGraphics.y=this.originalTopY,this.bottomGraphics.scaleY=1}onPointerOut(){this.topContainer.y=this.originalTopY,this.bottomGraphics.y=this.originalTopY,this.bottomGraphics.scaleY=1}}class f{constructor(t){e(this,"scene"),e(this,"screenWidth"),e(this,"screenHeight"),e(this,"bottomNavigation"),e(this,"topNavigation"),e(this,"contentContainer"),this.scene=t,this.screenWidth=this.scene.scale.width,this.screenHeight=this.scene.scale.height;const i=.12*this.screenHeight,s=this.screenWidth/2,o=this.screenHeight/2;this.scene.add.image(s,o,"bg"),this.bottomNavigation=new Phaser.GameObjects.Container(this.scene,s,this.screenHeight-i/2);const n=new Phaser.GameObjects.Rectangle(this.scene,0,0,this.screenWidth,i,10066329,5).setBlendMode(Phaser.BlendModes.MULTIPLY);this.bottomNavigation.add(n);const h=[{label:"hey",color:"pink"},{label:"hi",color:"purple"},{label:"hoo",color:"blue"},{label:"bye",color:"yellow"}],r=h.length,a=this.screenWidth/(r+1);h.forEach(((t,e)=>{const o=(e+1)*a-s,n=-i/3,h=new w(this.scene,o,n,t.color,void 0,t.label,56,52);this.bottomNavigation.add(h)})),this.topNavigation=new Phaser.GameObjects.Container(this.scene,s,0),this.contentContainer=new Phaser.GameObjects.Container(this.scene,s,0),this.scene.add.existing(this.bottomNavigation),this.scene.add.existing(this.topNavigation),this.scene.add.existing(this.contentContainer)}}class x extends o.Scene{constructor(){super({key:"MainScene"})}create(){new f(this)}}const G={type:o.AUTO,width:390,height:844,pixelArt:!1,title:"Purple Land",scene:[n,x,m],parent:"game-container",scale:{mode:o.Scale.RESIZE,autoCenter:o.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}}};window.addEventListener("load",(()=>{new o.Game(G)}));
