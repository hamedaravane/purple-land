var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,g as i}from"./phaser-CKN4kaq3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const o=i(s());class r extends o.Scene{constructor(){super({key:"BootScene"})}preload(){this.load.image("background","assets/images/background/background.png"),this.load.atlas("bubbles","assets/images/bubbles/bubbles_spritesheet.png","assets/images/bubbles/bubbles_spritesheet.json")}create(){this.scene.start("GameScene")}}class l extends Phaser.GameObjects.Sprite{constructor(e,s,i,o,r="static",l="bubbles",h){super(e,s,i,l,h.label),t(this,"bubbleType"),t(this,"_color"),t(this,"neighbors",[]),t(this,"_diameter"),this.bubbleType=r,this._color=h,this._diameter=o,this.scene.add.existing(this),this.setBubbleSize(),this.initPhysics()}get color(){return this._color}setStatic(){this.bubbleType="static"}pop(){this.destroy()}fall(){this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.enable=!0,this.body.setVelocityY(200))}shot(e,t=600){if("shooting"!==this.bubbleType)return;const s=e.x-this.x,i=e.y-this.y,o=Math.sqrt(s*s+i*i);if(o>0){const e=s/o,r=i/o;this.body.setVelocity(e*t,r*t)}}disablePhysics(){this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setVelocity(0,0),this.body.enable=!1)}addNeighbor(e){this.neighbors.includes(e)||this.neighbors.push(e)}removeNeighbor(e){const t=this.neighbors.indexOf(e);-1!==t&&this.neighbors.splice(t,1)}setBubbleSize(){const e=this.width,t=this.height;if(e>0&&t>0){const t=this._diameter/e;this.setScale(t)}else this.once(Phaser.Loader.Events.COMPLETE,(()=>{const e=this._diameter/this.width;this.setScale(e)}))}initPhysics(){this.scene.physics.add.existing(this),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setCollideWorldBounds(!0),this.body.setVelocity(0,0))}}const h=[{label:"orange",color:16081665},{label:"yellow",color:16109829},{label:"cyan",color:63127},{label:"light-blue",color:10150133},{label:"purple",color:9269719},{label:"pink",color:15626403}];function b(){const e=Math.floor(Math.random()*h.length);return{label:h[e].label,color:h[e].color}}class n{constructor(e,s,i,o,r){t(this,"bubblesGroup"),t(this,"grid"),t(this,"bubbleWidth"),this.bubbleWidth=r,this.grid=Array.from({length:i},(()=>Array(s).fill(null))),this.createGrid(e,s,i,o)}createGrid(e,t,s,i){this.bubblesGroup=new Phaser.GameObjects.Group(e);const o=this.bubbleWidth/2,r=.866*this.bubbleWidth;for(let h=0;h<s;h++){const s=h%2==0,n=s?o:0;for(let c=0;c<t-(s?1:0);c++){const t=o+c*this.bubbleWidth+n,s=new l(e,t,o+h*r,this.bubbleWidth,"static",i,b());this.bubblesGroup.add(s),this.grid[h][c]=s}}}addBubble(e,t,s,i,o){const{row:r,col:h}=this.findClosestGridPosition(t,s);if(!this.isPositionOccupied(r,h)){const t=this.calculateBubbleX(h,r),s=this.calculateBubbleY(r),b=new l(e,t,s,this.bubbleWidth,"static",i,o);this.bubblesGroup.add(b),this.grid[r][h]=b}}findClosestGridPosition(e,t){const s=this.bubbleWidth/2,i=Math.round((t-s)/(s*Math.sqrt(3)));return{row:i,col:Math.round((e-s-(i%2==0?s:0))/this.bubbleWidth)}}isPositionOccupied(e,t){var s;return null!==(null==(s=this.grid[e])?void 0:s[t])}calculateBubbleX(e,t){const s=this.bubbleWidth/2,i=t%2==0?s:0;return s+e*this.bubbleWidth+i}calculateBubbleY(e){return this.bubbleWidth/2+e*(.866*this.bubbleWidth)}}class c extends Phaser.Scene{constructor(){super({key:"GameScene"}),t(this,"shootingBubble"),t(this,"aimer"),t(this,"cols"),t(this,"rows")}create(){this.cols=15,this.rows=10;const e=new Phaser.GameObjects.Sprite(this,0,0,"background");this.add.existing(e),new n(this,this.cols,this.rows,"bubbles",this.scale.width/this.cols),this.spawnShootingBubble()}spawnShootingBubble(){this.shootingBubble&&this.shootingBubble.destroy(),this.aimer&&this.aimer.destroy(),this.shootingBubble=new l(this,this.scale.width/2,this.scale.height-100,this.scale.width/this.cols,"shooting","bubbles",b())}}const a={type:o.AUTO,width:390,height:844,pixelArt:!1,title:"Purple Land",scene:[r,c],parent:"game-container",scale:{mode:o.Scale.RESIZE,autoCenter:o.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}}};window.addEventListener("load",(()=>{new o.Game(a)}));
